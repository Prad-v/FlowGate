# OpenTelemetry Collector Builder Configuration
# This configuration builds a custom collector with OpAMP extension support

dist:
  name: otelcol-flowgate
  description: FlowGate Custom OpenTelemetry Collector with OpAMP Extension
  output_path: ./dist

extensions:
  # OpAMP extension for agent management (from contrib repository)
  # Upgraded to v0.139.0 for full OpAMP capabilities support
  - gomod: github.com/open-telemetry/opentelemetry-collector-contrib/extension/opampextension v0.139.0

receivers:
  # OTLP receiver for receiving telemetry data
  - gomod: go.opentelemetry.io/collector/receiver/otlpreceiver v0.139.0
  # Prometheus receiver for scraping metrics (from contrib repository)
  - gomod: github.com/open-telemetry/opentelemetry-collector-contrib/receiver/prometheusreceiver v0.139.0

processors:
  # Batch processor for batching telemetry data
  - gomod: go.opentelemetry.io/collector/processor/batchprocessor v0.139.0
  # Memory limiter to prevent OOM
  - gomod: go.opentelemetry.io/collector/processor/memorylimiterprocessor v0.139.0

exporters:
  # OTLP exporter for forwarding telemetry
  - gomod: go.opentelemetry.io/collector/exporter/otlpexporter v0.139.0
  # OTLP HTTP exporter
  - gomod: go.opentelemetry.io/collector/exporter/otlphttpexporter v0.139.0
  # Debug exporter for troubleshooting
  - gomod: go.opentelemetry.io/collector/exporter/debugexporter v0.139.0

service:
  extensions: [opamp]
  pipelines:
    traces:
      receivers: [otlp]
      processors: [memorylimiter, batch]
      exporters: [otlp, otlphttp, debug]
    metrics:
      receivers: [otlp, prometheus]
      processors: [memorylimiter, batch]
      exporters: [otlp, otlphttp, debug]
    logs:
      receivers: [otlp]
      processors: [memorylimiter, batch]
      exporters: [otlp, otlphttp, debug]

