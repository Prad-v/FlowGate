# OpAMP Supervisor Configuration for Gateway-2
# This configuration is used when USE_SUPERVISOR=true for gateway-2

server:
  endpoint: ${OPAMP_WS_URL}/api/v1/opamp/v1/opamp?token=${OPAMP_TOKEN}
  headers:
    Authorization: "Bearer ${OPAMP_TOKEN}"
  tls:
    insecure_skip_verify: true

capabilities:
  # OpAMP capabilities supported by supervisor (per config.go)
  # Reference: https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/cmd/opampsupervisor/supervisor/config/config.go
  #
  # The supervisor supports a subset of OpAMP capabilities that can be explicitly configured.
  # These capabilities are reported to the OpAMP server in the AgentToServer message.
  # The supervisor reads these settings and includes them in the capability bit-field.
  
  # Remote configuration support (matches server's OffersRemoteConfig)
  accepts_remote_config: true        # Agent accepts remote configuration from server
  reports_remote_config: true        # Agent reports status of remote config application
  reports_effective_config: true     # Agent reports its current effective configuration
  
  # Telemetry reporting capabilities
  # These allow the agent to report its own telemetry data (metrics, logs, traces)
  # to destinations specified by the server via ConnectionSettingsOffers
  reports_own_metrics: true         # Agent reports its own metrics
  reports_own_logs: true            # Agent reports its own logs
  reports_own_traces: true          # Agent reports its own traces
  
  # Health and status reporting
  reports_health: true              # Agent reports health status
  reports_heartbeat: true           # Agent sends heartbeat messages (periodic status updates)
  
  # Connection settings and components
  accepts_opamp_connection_settings: true  # Agent accepts OpAMP connection settings (TLS, etc.)
  reports_available_components: true      # Agent reports available collector components
  
  # Restart command support
  accepts_restart_command: true     # Agent accepts restart commands from server
  
  # ============================================================================
  # AUTOMATICALLY ENABLED CAPABILITIES (not configurable)
  # ============================================================================
  # The following capabilities are always enabled by the supervisor and cannot be
  # configured via supervisor.yaml (they are hardcoded in supervisor's SupportedCapabilities()):
  #
  # - reports_status: Always enabled (required by OpAMP spec, bit 0)
  #   The supervisor always reports agent status, so this capability is always set.
  
  # ============================================================================
  # NOT SUPPORTED BY SUPERVISOR CONFIG
  # ============================================================================
  # The following capabilities are NOT in the supervisor's Capabilities struct and
  # cannot be configured via supervisor.yaml. They may be handled via OpAMP protocol
  # negotiation or are not supported by the supervisor:
  #
  # - accepts_packages: Not in supervisor Capabilities struct
  #   Package management may be handled via protocol negotiation if server offers it.
  #
  # - reports_package_statuses: Not in supervisor Capabilities struct
  #   Package status reporting may be handled via protocol negotiation.
  #
  # - accepts_other_connection_settings: Not in supervisor Capabilities struct
  #   Other connection settings (non-OpAMP) may be handled via protocol negotiation.
  #
  # - reports_connection_settings_status: Not in supervisor Capabilities struct
  #   Connection settings status reporting may be handled via protocol negotiation.

agent:
  executable: /otelcol
  args:
    - --config=/etc/otelcol/config-supervisor.yaml
  # Port for local OpAMP server that collector connects to
  opamp_server_port: 4321
  # Increase bootstrap timeout to allow supervisor's local server to start
  bootstrap_timeout: 60s
  config_apply_timeout: 60s
  # Enable passthrough logs to see collector output
  # Note: Collector log level is set to 'warn' in collector config, so only warnings/errors will be passed through
  # Disabled to reduce log verbosity - collector errors will still be visible in supervisor logs
  passthrough_logs: false

storage:
  directory: /var/lib/opampsupervisor

